# Git 管理器

Git 管理器负责处理 CLI 的 Git 操作，包括创建分支和提交。

## 概述

Git 管理器提供以下 Git 操作：
- 检查仓库状态
- 创建文档分支
- 提交生成的文档
- 获取仓库信息

## 类定义

```python
class GitManager:
    def __init__(self, repo_path: Path):
        """Initialize git manager."""
        self.repo_path = Path(repo_path).expanduser().resolve()
        self.repo = git.Repo(repo_path, search_parent_directories=True)
```

## 核心方法

### check_clean_working_directory()

检查是否有未提交的更改：

```python
def check_clean_working_directory(self) -> Tuple[bool, str]:
    """Check if working directory is clean."""
    if self.repo.is_dirty(untracked_files=True):
        return False, "Has uncommitted changes"
    return True, "Clean"
```

### create_documentation_branch()

创建带时间戳的分支：

```python
def create_documentation_branch(self, force: bool = False) -> str:
    """Create a new documentation branch."""
    if not force:
        is_clean, _ = self.check_clean_working_directory()
        if not is_clean:
            raise RepositoryError("Cannot create branch with uncommitted changes")

    timestamp = datetime.now().strftime("%Y%m%d-%H%M%S")
    branch_name = f"docs/codewiki-{timestamp}"

    new_branch = self.repo.create_head(branch_name)
    new_branch.checkout()

    return branch_name
```

### commit_documentation()

提交生成的文档：

```python
def commit_documentation(self, docs_path: Path, message: str = None) -> str:
    """Commit generated documentation."""
    if message is None:
        message = "Add generated documentation\n\nGenerated by CodeWiki CLI"

    self.repo.index.add([str(docs_path)])
    commit = self.repo.index.commit(message)

    return commit.hexsha
```

### get_remote_url()

获取远程仓库 URL：

```python
def get_remote_url(self, remote_name: str = "origin") -> Optional[str]:
    """Get remote repository URL."""
    try:
        return self.repo.remote(remote_name).url
    except ValueError:
        return None
```

## 用法

```bash
# Generate with branch creation
codewiki generate /path/to/repo --create-branch

# Commit automatically
codewiki generate /path/to/repo --create-branch --commit
```

## 相关文档

- [CLI 概述](cli_overview.md)